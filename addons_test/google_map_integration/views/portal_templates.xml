<?xml version="1.0" encoding="utf-8"?>
<odoo>


    <template id="my_portal_my_details_googlemap" inherit_id="portal.portal_my_details">

       <xpath expr="//form/div/div/div[@class='row']" position="inside">
              <div t-attf-class="form-group #{error.get('zip') and 'o_has_error' or ''} col-xl-6">

			    <label class="col-form-label" for="city">Select your location</label>
			     <br></br>
        <input id="searchInput" name="searchInput"   class="form-control" type="text" placeholder="Search location"/>
        <input type="hidden" name="partlat" id="partlat"/>
        <input type="hidden" name="partlong" id="partlong"/>

       <div id="map" name="map" ></div>

       <ul id="ulid" class="geo-data">
       <li>Latitude: <span id="lat"></span></li>
    <li>Longitude: <span id="lon"></span></li>
    </ul>
    <style>
       /* Set the size of the div element that contains the map */
      #map {
        height: 300px;  /* The height is 400 pixels */
        width: 300%;  /* The width is the width of the web page */
       }
        #searchInput {
        background-color: #fff;
        padding: 0 11px 0 13px;
        width: 400px;
        font-family: Roboto;
        font-size: 15px;
        font-weight: 300;
        text-overflow: ellipsis;
      }

      #searchInput:focus {
        border-color: #4d90fe;
        margin-left: -1px;
        padding-left: 14px;  /* Regular padding-left + 1. */
        width: 401px;
      }
    </style>

     <script>
      faisalabad = {lat:31.4181, lng:73.0776};
 function addYourLocationButton (map, marker)
{
    var controlDiv = document.createElement('div');

    var firstChild = document.createElement('button');
    firstChild.style.backgroundColor = '#fff';
    firstChild.style.border = 'none';
    firstChild.style.outline = 'none';
    firstChild.style.width = '28px';
    firstChild.style.height = '28px';
    firstChild.style.borderRadius = '2px';
    firstChild.style.boxShadow = '0 1px 4px rgba(0,0,0,0.3)';
    firstChild.style.cursor = 'pointer';
    firstChild.style.marginRight = '10px';
    firstChild.style.padding = '0';
    firstChild.title = 'Your Location';
    controlDiv.appendChild(firstChild);

    var secondChild = document.createElement('div');
    secondChild.style.margin = '5px';
    secondChild.style.width = '25px';
    secondChild.style.height = '25px';
    secondChild.style.backgroundImage = 'url(https://maps.gstatic.com/tactile/mylocation/mylocation-sprite-2x.png)';
    secondChild.style.backgroundSize = '180px 18px';
    secondChild.style.backgroundPosition = '0 0';
    secondChild.style.backgroundRepeat = 'no-repeat';
    firstChild.appendChild(secondChild);

    google.maps.event.addListener(map, 'center_changed', function () {
        secondChild.style['background-position'] = '0 0';
    });

    firstChild.addEventListener('click', function (e) {
    e.preventDefault();
        var imgX = 0,
            animationInterval = setInterval(function () {
                imgX = -imgX - 18 ;
                secondChild.style['background-position'] = imgX+'px 0';
            }, 500);

        if(navigator.geolocation) {
        console.log(navigator.geolocation);
            navigator.geolocation.getCurrentPosition(function(position) {
                var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
                map.setCenter(latlng);
                secondChild.style['background-position'] = '-144px 0';
                marker.setPosition(latlng);
        		marker.setVisible(true);
               var selectedlatitude=document.getElementById("partlat");
       	var selectedlongitude=document.getElementById("partlong");
       	selectedlatitude.value=position.coords.latitude;
       	selectedlongitude.value=position.coords.longitude;
       	 document.getElementById('lat').innerHTML= position.coords.latitude;
        document.getElementById('lon').innerHTML = position.coords.longitude;
       	console.log(position.coords.latitude);
       console.log(position.coords.longitude);


            });
        } else {
                  alert("Sorry, browser does not support geolocation!");

            clearInterval(animationInterval);
            secondChild.style['background-position'] = '0 0';
        }
    });

    controlDiv.index = 1;
    map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(controlDiv);

}



function initMap1() {

   var map = new google.maps.Map(document.getElementById('map'), {
      center: {lat: 11.0163015, lng:  76.1204085},
      zoom: 13
    });



	  var myMarker = new google.maps.Marker({
        map: map,
        position: faisalabad
    });
    addYourLocationButton(map, myMarker);






    var input = document.getElementById('searchInput');
    map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

    var autocomplete = new google.maps.places.Autocomplete(input);
    autocomplete.bindTo('bounds', map);

    var infowindow = new google.maps.InfoWindow();
    var marker = new google.maps.Marker({
        map: map,
        anchorPoint: new google.maps.Point(0, -29)
    });

    autocomplete.addListener('place_changed', function() {
        infowindow.close();
        marker.setVisible(false);
        var place = autocomplete.getPlace();
        if (!place.geometry) {
            window.alert("Autocomplete's returned place contains no geometry");
            return;
        }

        // If the place has a geometry, then present it on a map.
        if (place.geometry.viewport) {
            map.fitBounds(place.geometry.viewport);
        } else {
            map.setCenter(place.geometry.location);
            map.setZoom(17);
        }
        marker.setIcon(({
            url: place.icon,
            size: new google.maps.Size(71, 71),
            origin: new google.maps.Point(0, 0),
            anchor: new google.maps.Point(17, 34),
            scaledSize: new google.maps.Size(35, 35)
        }));
        marker.setPosition(place.geometry.location);
        marker.setVisible(true);

        var address = '';
        if (place.address_components) {
            address = [
              (place.address_components[0] &amp;&amp; place.address_components[0].short_name || ''),
              (place.address_components[1] &amp;&amp; place.address_components[1].short_name || ''),
              (place.address_components[2] &amp;&amp; place.address_components[2].short_name || '')
            ].join(' ');
        }

        infowindow.setContent('<div><strong>' + place.name + '</strong><br></br></div>' + address);
        infowindow.open(map, marker);

        // Location details
        //for (var i = 0; place.address_components.length > 1; i++) {
            //if(place.address_components[i].types[0] == 'postal_code'){
              //  document.getElementById('postal_code').html( place.address_components[i].long_name);
            //}
           // if(place.address_components[i].types[0] == 'country'){
           //     document.getElementById('country').html ( place.address_components[i].long_name);
         //   }
       // }
       // document.getElementById('location').innerHTML = place.formatted_address;
        document.getElementById('lat').innerHTML= place.geometry.location.lat();
        document.getElementById('lon').innerHTML = place.geometry.location.lng();
       	var selectedlatitude=document.getElementById("partlat");
       	var selectedlongitude=document.getElementById("partlong");
       	selectedlatitude.value=place.geometry.location.lat();
       	selectedlongitude.value=place.geometry.location.lng();
       	console.log(selectedlatitude.value);




    });





}



</script>




 <script t-attf-src="https://maps.googleapis.com/maps/api/js?libraries=places&amp;key=#{google_maps_api_key.value}&amp;callback=initMap1" ></script>
		</div>
       	</xpath>
    </template>

</odoo>
